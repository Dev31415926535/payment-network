<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduChain Nexus - Home</title>
    <style>
        :root {
            --primary-color: #FF6B6B;
            --secondary-color: #4ECDC4;
            --accent-color: #FFD93D;
            --text-color: #2F2E41;
            --bg-color: #F7F7F7;
        }
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow-x: hidden;
        }
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }        
        header {
            background-color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
            position: relative;
            width: 100%;
            box-sizing: border-box;
        }
        .logo {
            font-size: 1.5em;
            font-weight: bold;
            color: #000;
            display: flex;
            align-items: center;
        }
        .logo-img {
            height: 50px;  
            margin-right: 10px;
        }
        nav ul {
            list-style-type: none;
            display: flex;
            gap: 20px;
            margin: 0;
        }
        nav ul li a {
            color: #000;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        nav ul li a:hover {
            color: #78B7D0;
        }
        .contact-btn, .profile-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-weight: bold;
        }
        .contact-btn:hover, .profile-btn:hover {
            background-color: var(--primary-color);
        }
        .container {
            position: relative;
            z-index: 10;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            color: white;
        }
        h1 {
            font-size: 2.5rem;
        }
        .nav-buttons {
            margin-top: 30px;
        }
        .nav-button {
            display: inline-block;
            padding: 10px 20px;
            margin: 10px;
            background-color: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .nav-button:hover {
            background-color: var(--secondary-color);
        }
        .container {
            position: relative;
            z-index: 10;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            color: white;
        }
        main {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }
        h1 {
            font-size: 2.5em;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 40px;
        }
        .to-be-added {
            text-align: center;
            font-size: 1.2em;
            color: var(--secondary-color);
            margin-top: 40px;
            font-style: italic;
        }
        .items-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }
        .item {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .item-name {
            font-weight: 500;
            margin-bottom: 5px;
        }
        .item-description {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }
        .item-username {
            font-size: 0.8em;
            color: var(--secondary-color);
            margin-bottom: 10px;
        }
        .item-action {
            background-color: var(--accent-color);
            color: var(--text-color);
            border: none;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .item-action:hover {
            background-color: var(--primary-color);
            color: white;
        }
        .Borrowing-form {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }
        .Borrowing-form h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        .Borrowing-form form {
            display: grid;
            gap: 15px;
        }
        .Borrowing-form input, .Borrowing-form textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .Borrowing-form button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-weight: bold;
        }
        .Borrowing-form button:hover {
            background-color: var(--primary-color);
        }
    </style>
</head>
<body>
    <canvas class="background"></canvas>
    <header>
        <div class="logo">
            <img src="logo.png" alt="Educhain Nexus Logo" class="logo-img">
            Educhain Nexus
        </div>
 
    </header>
    <main>
        <h1>Welcome to EduChain Nexus</h1>
        <p class="to-be-added">Unlock the power of lending and borrowing with EduChain!<br> 
            Our platform connects borrowers with lenders, making it easy to find the financial help you need to invest in opportunities
            Join our community today and start making smarter financial decisions. Explore our platform</p>
        
        <div  id="BorrowingForm" class="Borrowing-form">
            <h2>Borrow an Item</h2>
            <form onsubmit="return handleItems(event)">
                <input type="text" id="itemName" placeholder="Item Name" required>
                <input type="text" id="itemDescription" placeholder="Item Description" required>
                <input type="text" id="userName" placeholder="Your Name" required>
                <input type="email" id="userEmail" placeholder="Your Email" required>
                <button type="submit">Add Item for Borrowing</button>
            </form>
        </div>
        <div class="items-container">
            <!-- Items will be dynamically inserted here -->
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/simplex-noise/2.4.0/simplex-noise.min.js"></script>
    <script>
        // Dynamic background
        const canvas = document.querySelector('.background');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const simplex = new SimplexNoise();
        let t = 0;

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'rgba(255, 107, 107, 0.1)'; // Very light red

            for (let x = 0; x < canvas.width; x += 5) {
                const y = simplex.noise2D(x / 100, t / 100) * 100 + canvas.height / 2;
                ctx.beginPath();
                ctx.arc(x, y, 2, 0, Math.PI * 2);
                ctx.fill();
            }

            t++;
            requestAnimationFrame(animate);
        }

        animate();

          // Delete function
        async function deleteItem(id) {
            try {
                console.log('Deleted');
                const response = await fetch(`/deleteitem/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    window.location.href="transactions.html"
                    alert('Item deleted successfully');
                    // Refresh the list or remove the deleted item from DOM
                    // location.reload(); // You can improve this by dynamically removing the item from the list instead of reloading
                } else {
                    alert('Error deleting item');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }
        

        // Function to populate items
        async function populateItems() {
            let items = await fetch("/getitems").then(response => response.json());//get borrowed functionality from
            console.log(items);

            const itemsContainer = document.querySelector('.items-container');
            itemsContainer.innerHTML = ''; // Clear existing items
            items.forEach(item => {//if item.ownername!=myname or item.lendersname!=myname 
                const itemElement = document.createElement('div');//continue 
                itemElement.className = 'item';
                // <img src="${item.image}" alt="${item.name}">
                itemElement.innerHTML = `
                    <h3 class="item-name">${item.itemName}</h3>
                    <p class="item-description">${item.itemDescription}</p>
                    <p class="item-username">username: ${item.ownerName}</p>
                    <p class="item-username">Contact: ${item.ownerEmail}</p> 
                    <button class="item-action" onclick="deleteItem('${item._id}')">lend</button>
                `;//two more p tags
                itemsContainer.appendChild(itemElement);
            });
            
        }

        // Populate items initially
        populateItems();

        // Handle form submission
        function handleItems(event) {
            event.preventDefault();

            const name = document.getElementById("itemName").value;
            const description = document.getElementById("itemDescription").value;
            const username = document.getElementById("userName").value;
            const contact = document.getElementById("userEmail").value;

            // Send the item to the backend via fetch
            fetch('/items', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({name,description,username,contact}),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    sessionStorage.setItem('username', username);
                    alert('Stored in database');
                } else {
                    alert('item addition failed: ' + data.message);
                }
            })
            .catch((error) => {
                console.error('Error:', error);
                alert('An error occurred during storage.');
            })
            .finally(() => {
                populateItems();
                // Add new item to the beginning of the array
                items.unshift(newItem); 
                // Clear the form
                document.getElementById('Borrowing-form').reset();
                alert('Your item has been added for borrowing!');
            });
        }

        function fetchItems() {
            fetch('/getitems')  // Assuming your backend is running on the same domain/port
                .then(response => response.json())
                .then(data => {
                    if (data) {
                        displayItems(data);  // Call a function to display the items
                    } else {
                        console.error('Failed to fetch items');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        // Function to dynamically create HTML for each item and append it to the DOM
        function displayItems(items) {
            const itemsContainer = document.getElementById('itemsContainer');
            itemsContainer.innerHTML = '';  // Clear the container before appending new items

            items.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.classList.add('item');
                
                itemElement.innerHTML = `
                    <h3>${item.itemName}</h3>
                    <p><strong>Description:</strong> ${item.itemDescription}</p>
                    <p><strong>Owner:</strong> ${item.ownerName}</p>
                    <p><strong>Email:</strong> ${item.ownerEmail}</p>
                `;
                
                itemsContainer.appendChild(itemElement);  // Append each item to the container
            });
        }

        // Call fetchItems to fetch and display items when the page loads
        window.onload = fetchItems;

        // Button event listeners
        document.querySelector('.contact-btn').addEventListener('click', function() {
            window.location.href = 'contact.html';
        });
        document.querySelector('.profile-btn').addEventListener('click', function() {
            window.location.href = 'profile.html';
        });
        
    </script>
    
</body>
</html>
